!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.MoeRecaptcha=t()}(this,function(){"use strict";const e=new WeakMap,t=t=>"function"==typeof t&&e.has(t),s=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,i=(e,t,s=null)=>{let i=t;for(;i!==s;){const t=i.nextSibling;e.removeChild(i),i=t}},n={},r=`{{lit-${String(Math.random()).slice(2)}}}`,o=`\x3c!--${r}--\x3e`,a=new RegExp(`${r}|${o}`),c=(()=>{const e=document.createElement("div");return e.setAttribute("style","{{bad value}}"),"{{bad value}}"!==e.getAttribute("style")})();class l{constructor(e,t){this.parts=[],this.element=t;let s=-1,i=0;const n=[],o=t=>{const l=t.content,h=document.createTreeWalker(l,133,null,!1);let u,m;for(;h.nextNode();){s++,u=m;const t=m=h.currentNode;if(1===t.nodeType){if(t.hasAttributes()){const n=t.attributes;let o=0;for(let e=0;e<n.length;e++)n[e].value.indexOf(r)>=0&&o++;for(;o-- >0;){const n=e.strings[i],r=p.exec(n)[2],o=c&&"style"===r?"style$":/^[a-zA-Z-]*$/.test(r)?r:r.toLowerCase(),l=t.getAttribute(o).split(a);this.parts.push({type:"attribute",index:s,name:r,strings:l}),t.removeAttribute(o),i+=l.length-1}}"TEMPLATE"===t.tagName&&o(t)}else if(3===t.nodeType){const e=t.nodeValue;if(e.indexOf(r)<0)continue;const o=t.parentNode,c=e.split(a),l=c.length-1;i+=l;for(let e=0;e<l;e++)o.insertBefore(""===c[e]?d():document.createTextNode(c[e]),t),this.parts.push({type:"node",index:s++});o.insertBefore(""===c[l]?d():document.createTextNode(c[l]),t),n.push(t)}else if(8===t.nodeType)if(t.nodeValue===r){const e=t.parentNode,r=t.previousSibling;null===r||r!==u||r.nodeType!==Node.TEXT_NODE?e.insertBefore(d(),t):s--,this.parts.push({type:"node",index:s++}),n.push(t),null===t.nextSibling?e.insertBefore(d(),t):s--,m=u,i++}else{let e=-1;for(;-1!==(e=t.nodeValue.indexOf(r,e+1));)this.parts.push({type:"node",index:-1})}}};o(t);for(const e of n)e.parentNode.removeChild(e)}}const h=e=>-1!==e.index,d=()=>document.createComment(""),p=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F \x09\x0a\x0c\x0d"'>=\/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class u{constructor(e,t,s){this._parts=[],this.template=e,this.processor=t,this.options=s}update(e){let t=0;for(const s of this._parts)void 0!==s&&s.setValue(e[t]),t++;for(const e of this._parts)void 0!==e&&e.commit()}_clone(){const e=s?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=this.template.parts;let i=0,n=0;const r=e=>{const s=document.createTreeWalker(e,133,null,!1);let o=s.nextNode();for(;i<t.length&&null!==o;){const e=t[i];if(h(e))if(n===e.index){if("node"===e.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(o),this._parts.push(e)}else this._parts.push(...this.processor.handleAttributeExpressions(o,e.name,e.strings,this.options));i++}else n++,"TEMPLATE"===o.nodeName&&r(o.content),o=s.nextNode();else this._parts.push(void 0),i++}};return r(e),s&&(document.adoptNode(e),customElements.upgrade(e)),e}}class m{constructor(e,t,s,i){this.strings=e,this.values=t,this.type=s,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",s=!0;for(let i=0;i<e;i++){const e=this.strings[i];t+=e;const n=e.lastIndexOf(">");!(s=(n>-1||s)&&-1===e.indexOf("<",n+1))&&c&&(t=t.replace(p,(e,t,s,i)=>"style"===s?`${t}style$${i}`:e)),t+=s?o:r}return t+=this.strings[e]}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}const _=e=>null===e||!("object"==typeof e||"function"==typeof e);class f{constructor(e,t,s){this.dirty=!0,this.element=e,this.name=t,this.strings=s,this.parts=[];for(let e=0;e<s.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new g(this)}_getValue(){const e=this.strings,t=e.length-1;let s="";for(let i=0;i<t;i++){s+=e[i];const t=this.parts[i];if(void 0!==t){const e=t.value;if(null!=e&&(Array.isArray(e)||"string"!=typeof e&&e[Symbol.iterator]))for(const t of e)s+="string"==typeof t?t:String(t);else s+="string"==typeof e?e:String(e)}}return s+=e[t]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class g{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===n||_(e)&&e===this.value||(this.value=e,t(e)||(this.committer.dirty=!0))}commit(){for(;t(this.value);){const e=this.value;this.value=n,e(this)}this.value!==n&&this.committer.commit()}}class v{constructor(e){this.value=void 0,this._pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(d()),this.endNode=e.appendChild(d())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e._insert(this.startNode=d()),e._insert(this.endNode=d())}insertAfterPart(e){e._insert(this.startNode=d()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this._pendingValue=e}commit(){for(;t(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n,e(this)}const e=this._pendingValue;e!==n&&(_(e)?e!==this.value&&this._commitText(e):e instanceof m?this._commitTemplateResult(e):e instanceof Node?this._commitNode(e):Array.isArray(e)||e[Symbol.iterator]?this._commitIterable(e):void 0!==e.then?this._commitPromise(e):this._commitText(e))}_insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}_commitNode(e){this.value!==e&&(this.clear(),this._insert(e),this.value=e)}_commitText(e){const t=this.startNode.nextSibling;e=null==e?"":e,t===this.endNode.previousSibling&&t.nodeType===Node.TEXT_NODE?t.textContent=e:this._commitNode(document.createTextNode("string"==typeof e?e:String(e))),this.value=e}_commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value&&this.value.template===t)this.value.update(e.values);else{const s=new u(t,e.processor,this.options),i=s._clone();s.update(e.values),this._commitNode(i),this.value=s}}_commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let s,i=0;for(const n of e)void 0===(s=t[i])&&(s=new v(this.options),t.push(s),0===i?s.appendIntoPart(this):s.insertAfterPart(t[i-1])),s.setValue(n),s.commit(),i++;i<t.length&&(t.length=i,this.clear(s&&s.endNode))}_commitPromise(e){this.value=e,e.then(t=>{this.value===e&&(this.setValue(t),this.commit())})}clear(e=this.startNode){i(this.startNode.parentNode,e.nextSibling,this.endNode)}}class y{constructor(e,t,s){if(this.value=void 0,this._pendingValue=void 0,2!==s.length||""!==s[0]||""!==s[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=s}setValue(e){this._pendingValue=e}commit(){for(;t(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n,e(this)}if(this._pendingValue===n)return;const e=!!this._pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)),this.value=e,this._pendingValue=n}}class x extends f{constructor(e,t,s){super(e,t,s),this.single=2===s.length&&""===s[0]&&""===s[1]}_createPart(){return new b(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class b extends g{}let w=!1;try{const e={get capture(){return w=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}class P{constructor(e,t,s){this.value=void 0,this._pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=s}setValue(e){this._pendingValue=e}commit(){for(;t(this._pendingValue);){const e=this._pendingValue;this._pendingValue=n,e(this)}if(this._pendingValue===n)return;const e=this._pendingValue,s=this.value,i=null==e||null!=s&&(e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive),r=null!=e&&(null==s||i);i&&this.element.removeEventListener(this.eventName,this,this._options),this._options=S(e),r&&this.element.addEventListener(this.eventName,this,this._options),this.value=e,this._pendingValue=n}handleEvent(e){("function"==typeof this.value?this.value:"function"==typeof this.value.handleEvent?this.value.handleEvent:()=>null).call(this.eventContext||this.element,e)}}const S=e=>e&&(w?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);const N=new class{handleAttributeExpressions(e,t,s,i){const n=t[0];return"."===n?new x(e,t.slice(1),s).parts:"@"===n?[new P(e,t.slice(1),i.eventContext)]:"?"===n?[new y(e,t.slice(1),s)]:new f(e,t,s).parts}handleTextExpression(e){return new v(e)}};function T(e){let t=C.get(e.type);void 0===t&&(t=new Map,C.set(e.type,t));let s=t.get(e.strings);return void 0===s&&(s=new l(e,e.getTemplateElement()),t.set(e.strings,s)),s}const C=new Map,E=new WeakMap,V=(e,...t)=>new m(e,t,"html",N),A=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT;function k(e,t){const{element:{content:s},parts:i}=e,n=document.createTreeWalker(s,A,null,!1);let r=M(i),o=i[r],a=-1,c=0;const l=[];let h=null;for(;n.nextNode();){a++;const e=n.currentNode;for(e.previousSibling===h&&(h=null),t.has(e)&&(l.push(e),null===h&&(h=e)),null!==h&&c++;void 0!==o&&o.index===a;)o.index=null!==h?-1:o.index-c,o=i[r=M(i,r)]}l.forEach(e=>e.parentNode.removeChild(e))}const O=e=>{let t=e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?0:1;const s=document.createTreeWalker(e,A,null,!1);for(;s.nextNode();)t++;return t},M=(e,t=-1)=>{for(let s=t+1;s<e.length;s++){const t=e[s];if(h(t))return s}return-1};const R=(e,t)=>`${e}--${t}`;let I=!0;void 0===window.ShadyCSS?I=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected.Please update to at least @webcomponents/webcomponentsjs@2.0.2 and@webcomponents/shadycss@1.3.1."),I=!1);const F=["html","svg"],$=new Set,j=(e,t,s)=>{$.add(s);const i=e.querySelectorAll("style");if(0===i.length)return;const n=document.createElement("style");for(let e=0;e<i.length;e++){const t=i[e];t.parentNode.removeChild(t),n.textContent+=t.textContent}if((e=>{F.forEach(t=>{const s=C.get(R(t,e));void 0!==s&&s.forEach(e=>{const{element:{content:t}}=e,s=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{s.add(e)}),k(e,s)})})})(s),function(e,t,s=null){const{element:{content:i},parts:n}=e;if(null==s)return void i.appendChild(t);const r=document.createTreeWalker(i,A,null,!1);let o=M(n),a=0,c=-1;for(;r.nextNode();)for(c++,r.currentNode===s&&(a=O(t),s.parentNode.insertBefore(t,s));-1!==o&&n[o].index===c;){if(a>0){for(;-1!==o;)n[o].index+=a,o=M(n,o);return}o=M(n,o)}}(t,n,t.element.content.firstChild),window.ShadyCSS.prepareTemplateStyles(t.element,s),window.ShadyCSS.nativeShadow){const s=t.element.content.querySelector("style");e.insertBefore(s.cloneNode(!0),e.firstChild)}else{t.element.content.insertBefore(n,t.element.content.firstChild);const e=new Set;e.add(n),k(t,e)}},U=e=>null!==e,z=e=>e?"":null,L=(e,t)=>t!==e&&(t==t||e==e),q={attribute:!0,type:String,reflect:!1,hasChanged:L},B=new Promise(e=>e(!0)),W=1,H=4,D=8;class G extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=B,this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this._finalize();const e=[];for(const[t,s]of this._classProperties){const i=this._attributeNameForProperty(t,s);void 0!==i&&(this._attributeToPropertyMap.set(i,t),e.push(i))}return e}static createProperty(e,t=q){if(!this.hasOwnProperty("_classProperties")){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}if(this._classProperties.set(e,t),this.prototype.hasOwnProperty(e))return;const s="symbol"==typeof e?Symbol():`__${e}`;Object.defineProperty(this.prototype,e,{get(){return this[s]},set(i){const n=this[e];this[s]=i,this._requestPropertyUpdate(e,n,t)},configurable:!0,enumerable:!0})}static _finalize(){if(this.hasOwnProperty("_finalized")&&this._finalized)return;const e=Object.getPrototypeOf(this);"function"==typeof e._finalize&&e._finalize(),this._finalized=!0,this._attributeToPropertyMap=new Map;const t=this.properties,s=[...Object.getOwnPropertyNames(t),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t):[]];for(const e of s)this.createProperty(e,t[e])}static _attributeNameForProperty(e,t){const s=void 0!==t&&t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,s=L){return s(e,t)}static _propertyValueFromAttribute(e,t){const s=t&&t.type;if(void 0===s)return e;const i=s===Boolean?U:"function"==typeof s?s:s.fromAttribute;return i?i(e):e}static _propertyValueToAttribute(e,t){if(void 0===t||void 0===t.reflect)return;return(t.type===Boolean?z:t.type&&t.type.toAttribute||String)(e)}initialize(){this.renderRoot=this.createRenderRoot(),this._saveInstanceProperties()}_saveInstanceProperties(){for(const[e]of this.constructor._classProperties)if(this.hasOwnProperty(e)){const t=this[e];delete this[e],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(e,t)}}_applyInstanceProperties(){for(const[e,t]of this._instanceProperties)this[e]=t;this._instanceProperties=void 0}createRenderRoot(){return this.attachShadow({mode:"open"})}connectedCallback(){this._updateState&W?void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this):this.requestUpdate()}disconnectedCallback(){}attributeChangedCallback(e,t,s){t!==s&&this._attributeToProperty(e,s)}_propertyToAttribute(e,t,s=q){const i=this.constructor,n=i._propertyValueToAttribute(t,s);if(void 0!==n){const t=i._attributeNameForProperty(e,s);void 0!==t&&(this._updateState=this._updateState|D,null===n?this.removeAttribute(t):this.setAttribute(t,n),this._updateState=this._updateState&~D)}}_attributeToProperty(e,t){if(!(this._updateState&D)){const s=this.constructor,i=s._attributeToPropertyMap.get(e);if(void 0!==i){const e=s._classProperties.get(i);this[i]=s._propertyValueFromAttribute(t,e)}}}requestUpdate(e,t){if(void 0!==e){const s=this.constructor._classProperties.get(e)||q;return this._requestPropertyUpdate(e,t,s)}return this._invalidate()}_requestPropertyUpdate(e,t,s){return this.constructor._valueHasChanged(this[e],t,s.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0===s.reflect&&(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,s)),this._invalidate()):this.updateComplete}async _invalidate(){if(!this._hasRequestedUpdate){let e;this._updateState=this._updateState|H;const t=this._updatePromise;this._updatePromise=new Promise(t=>e=t),await t,this._validate(),e(!this._hasRequestedUpdate)}return this.updateComplete}get _hasRequestedUpdate(){return this._updateState&H}_validate(){if(this._instanceProperties&&this._applyInstanceProperties(),this.shouldUpdate(this._changedProperties)){const e=this._changedProperties;this.update(e),this._markUpdated(),this._updateState&W||(this._updateState=this._updateState|W,this.firstUpdated(e)),this.updated(e)}else this._markUpdated()}_markUpdated(){this._changedProperties=new Map,this._updateState=this._updateState&~H}get updateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){if(void 0!==this._reflectingProperties&&this._reflectingProperties.size>0){for(const[e,t]of this._reflectingProperties)this._propertyToAttribute(e,this[e],t);this._reflectingProperties=void 0}}updated(e){}firstUpdated(e){}}G._attributeToPropertyMap=new Map,G._finalized=!0,G._classProperties=new Map,G.properties={};class X extends G{update(e){super.update(e);const t=this.render();t instanceof m&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this})}render(){}}X.render=((e,t,s)=>{const n=s.scopeName,r=E.has(t);if(((e,t,s)=>{let n=E.get(t);void 0===n&&(i(t,t.firstChild),E.set(t,n=new v(Object.assign({templateFactory:T},s))),n.appendInto(t)),n.setValue(e),n.commit()})(e,t,Object.assign({templateFactory:(e=>t=>{const s=R(t.type,e);let i=C.get(s);void 0===i&&(i=new Map,C.set(s,i));let n=i.get(t.strings);if(void 0===n){const s=t.getTemplateElement();I&&window.ShadyCSS.prepareTemplateDom(s,e),n=new l(t,s),i.set(t.strings,n)}return n})(n)},s)),t instanceof ShadowRoot&&I&&e instanceof m){if(!$.has(n)){const e=E.get(t).value;j(t,e.template,n)}r||window.ShadyCSS.styleElement(t.host)}});class Z extends X{static get properties(){return{version:{type:Number},sitekey:{type:String},size:{type:String},badge:{type:String},recaptchaId:{type:Number},token:{type:String},executionPromise:{type:Object},executionPromiseResolve:{type:Function},executionPromiseReject:{type:Function}}}constructor(){super()}updated(e){if(e.has("version")&&2!==this.version&&3!==this.version)throw new Error("moe-recaptcha version must be either 2 or 3")}render(){return V`
<style>:host{display:block;}</style>
`}load(e){const t=`__fetchingGrecaptchaLibrary${this.version}__`,s=`__onloadGrecaptchaCallback${this.version}__`;return window[t]?Promise.resolve():new Promise((i,n)=>{window[t]=!0,window[s]=(()=>{window[t]=!1,2===parseInt(this.version)&&(this.recaptchaId=grecaptcha.render(e,{sitekey:this.sitekey,callback:this._responseCallback.bind(this),"error-callback":this._errorCallback.bind(this),"expired-callback":this._expiredCallback.bind(this),isolated:!0,size:this.size,badge:this.badge})),i()});const r=document.createElement("script"),o=2===this.version?`//www.google.com/recaptcha/api.js?onload=${s}&render=explicit`:`//www.google.com/recaptcha/api.js?onload=${s}&render=${this.sitekey}`;r.setAttribute("id","grecaptchaLibrary"),r.setAttribute("src",o),r.onerror=(e=>{console.error(e),window[t]=!1,n(e)}),document.head.appendChild(r)})}execute(...e){return 2===this.version?this._executev2():3===this.version?this._executev3(...e):void 0}reset(){2===this.version&&this.recaptchaId&&grecaptcha.reset(this.recaptchaId)}_executev2(){return this.recaptchaId&&grecaptcha.getResponse(this.recaptchaId)?Promise.resolve(grecaptcha.getResponse(this.recaptchaId)):(this.executionPromise=new Promise((e,t)=>{this.executionPromiseResolve=e,this.executionPromiseReject=t}),grecaptcha.execute(this.recaptchaId),this.executionPromise)}_executev3(e){return grecaptcha.execute(this.sitekey,{action:e})}_responseCallback(e){this.token=e,this.executionPromiseResolve(e)}_errorCallback(e){console.error(e),this.executionPromiseReject(e)}_expiredCallback(){console.log("recaptcha expired"),this.reset()}}return window.customElements.define("moe-recaptcha",Z),Z});
//# sourceMappingURL=moe-recaptcha.js.map
